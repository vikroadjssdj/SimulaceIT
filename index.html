<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktivn√≠ simulace TPM</title>
    <!-- Naƒçten√≠ Tailwind CSS z CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Naƒçten√≠ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Vlastn√≠ styly a p≈ôeps√°n√≠/doplnƒõn√≠ Tailwind -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* Tmavƒõ modrofialov√© pozad√≠ */
            color: #e0e0e0; /* Svƒõtl√° barva textu */
        }
        .neon-blue {
            box-shadow: 0 0 5px #00aaff, 0 0 10px #00aaff, 0 0 15px #00aaff;
            border-color: #00aaff;
        }
        .neon-green {
            box-shadow: 0 0 5px #00ffaa, 0 0 10px #00ffaa, 0 0 15px #00ffaa;
            border-color: #00ffaa;
            color: #00ffaa; /* Zmƒõna: P≈ôid√°na barva textu pro lep≈°√≠ efekt */
        }
        .neon-red {
            box-shadow: 0 0 5px #ff0055, 0 0 10px #ff0055, 0 0 15px #ff0055;
            border-color: #ff0055;
            color: #ff0055; /* Zmƒõna: P≈ôid√°na barva textu pro lep≈°√≠ efekt */
        }
        /* Definice vlastn√≠ch t≈ô√≠d pomoc√≠ @apply (vy≈æaduje Tailwind) */
        .btn {
            @apply px-4 py-2 rounded-lg font-semibold transition-all duration-300 ease-in-out border-2 border-transparent;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white neon-blue;
        }
        .btn-success {
            @apply bg-green-600 hover:bg-green-700 text-white neon-green; /* Odebr√°na barva textu odsud, ≈ôe≈°eno v .neon-green */
        }
        .btn-danger {
            @apply bg-red-600 hover:bg-red-700 text-white neon-red; /* Odebr√°na barva textu odsud, ≈ôe≈°eno v .neon-red */
        }
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 text-white border-gray-500;
        }
        .vault {
            @apply w-32 h-32 border-4 border-gray-400 rounded-lg flex items-center justify-center text-4xl transition-all duration-500 ease-in-out mx-auto my-4;
            background-color: #333; /* Barva trezoru */
        }
        .vault-locked {
            @apply border-blue-500 neon-blue;
            background-color: #2a2a4a; /* Tmav≈°√≠ modr√° pro zamƒçen√Ω trezor */
        }
        .vault-unlocked {
             @apply border-green-500 neon-green;
             /* Pozad√≠ m≈Ø≈æe z≈Østat svƒõtlej≈°√≠ nebo stejn√© jako p≈Øvodn√≠ */
             background-color: #333;
        }
        .vault-broken {
            @apply border-red-500 neon-red;
            background-color: #4a2a2a; /* Tmav≈°√≠ ƒçerven√° pro rozbit√Ω trezor */
        }
        .tab-content {
            @apply hidden p-4 border border-gray-600 rounded-b-lg bg-gray-850; /* Lehce odli≈°n√© pozad√≠ pro obsah tabu */
        }
        .tab-content.active {
            @apply block;
        }
        .tab-button {
            @apply px-4 py-2 font-semibold rounded-t-lg cursor-pointer transition-colors duration-300;
        }
        .tab-button.active {
            @apply bg-gray-700 text-white; /* Aktivn√≠ tab */
        }
        .tab-button:not(.active) {
            @apply bg-gray-800 text-gray-400 hover:bg-gray-700; /* Neaktivn√≠ tab */
        }
        /* Simple LED animation */
        @keyframes blink {
            50% { opacity: 0.5; }
        }
        .led {
            @apply w-3 h-3 rounded-full inline-block ml-2 align-middle; /* Pou≈æit√≠ align-middle pro lep≈°√≠ zarovn√°n√≠ s textem */
        }
        .led-off {
            @apply bg-gray-500;
        }
        .led-blue {
            @apply bg-blue-500 animate-pulse; /* Pou≈æit√≠ Tailwind animace */
            box-shadow: 0 0 3px #00aaff;
        }
        .led-green {
            @apply bg-green-500;
            box-shadow: 0 0 3px #00ffaa;
        }
        .led-red {
            @apply bg-red-500;
            box-shadow: 0 0 3px #ff0055;
        }
        /* P≈ôid√°n√≠ z√°kladn√≠ho stylu pro input pole pro konzistenci */
        input[type="text"] {
            background-color: #2a2a4a; /* Tmav≈°√≠ pozad√≠ pro input */
            border-color: #4a4a6a; /* Tmav≈°√≠ border */
        }
        input[type="text"]:focus {
             border-color: #00aaff; /* Modr√Ω border p≈ôi focusu */
             box-shadow: 0 0 5px #00aaff; /* Lehk√Ω neonov√Ω efekt p≈ôi focusu */
        }
    </style>
</head>
<body class="p-6">

    <div class="max-w-2xl mx-auto bg-gray-900 p-6 rounded-xl shadow-lg border border-gray-700">

        <h1 class="text-2xl font-bold text-center mb-1 text-blue-400">Interaktivn√≠ simulace TPM</h1>
        <p class="text-sm text-center text-gray-500 mb-2">Vytvo≈ôeno Viktorem Belanƒçinem pro prezentaci z Hardwaru 1. A IT.</p>
        <p class="text-center text-gray-400 mb-6">Vyzkou≈°ej si, jak TPM ƒçip chr√°n√≠ tvoje data.</p>

        <!-- Z√°lo≈æky -->
        <div class="mb-4 border-b border-gray-700">
            <nav class="flex">
                <button id="tab-sim" class="tab-button active" onclick="showTab('sim')">Simulace</button>
                <button id="tab-about" class="tab-button" onclick="showTab('about')">O TPM</button>
            </nav>
        </div>

        <!-- Obsah z√°lo≈æky Simulace -->
        <div id="content-sim" class="tab-content active">
            <div id="mode-selection" class="text-center mb-6">
                <p class="mb-4">Zvolte re≈æim simulace:</p>
                <button id="btn-with-tpm" class="btn btn-primary mr-4" onclick="selectMode('with-tpm')">‚úÖ Spustit s TPM</button>
                <button id="btn-without-tpm" class="btn btn-danger" onclick="selectMode('without-tpm')">‚ùå Spustit bez TPM</button>
            </div>

            <div id="simulation-area" class="hidden">
                <h2 id="mode-title" class="text-xl font-semibold mb-4 text-center"></h2>

                <!-- Trezor a stav -->
                <div id="vault" class="vault">
                    <span id="vault-icon">‚ùî</span> <!-- V√Ωchoz√≠ ikona -->
                </div>
                <div class="text-center mb-4">Stav: <span id="status-led" class="led led-off"></span><span id="status-text" class="ml-1">P≈ôipraven</span></div>

                <!-- Vstup pro zpr√°vu -->
                <div class="mb-4">
                    <label for="secret-message" class="block mb-2 text-sm font-medium text-gray-300">Zadej tajnou zpr√°vu:</label>
                    <input type="text" id="secret-message" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400" placeholder="nap≈ô. PIN: 5482">
                </div>

                <!-- Hlavn√≠ tlaƒç√≠tka akc√≠ -->
                <div class="flex justify-center space-x-4 mb-4">
                    <button id="btn-secure" class="btn btn-primary" onclick="secureMessage()">Zabezpeƒçit zpr√°vu</button>
                    <button id="btn-unlock" class="btn btn-secondary" onclick="prepareUnlock()" disabled>Odemknout zpr√°vu</button>
                </div>

                <!-- Sekce pro odemƒçen√≠ (zobrazeno dle pot≈ôeby) -->
                <div id="unlock-section" class="hidden mb-4">
                     <label for="tpm-id-input" class="block mb-2 text-sm font-medium text-gray-300">Zadej TPM identifik√°tor:</label>
                    <div class="flex space-x-2">
                       <input type="text" id="tpm-id-input" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400" placeholder="TPM-XXXX">
                       <button id="btn-confirm-unlock" class="btn btn-success" onclick="unlockMessage()">Potvrdit</button>
                    </div>
                </div>

                <!-- Tlaƒç√≠tko pro simulaci √∫toku -->
                 <div class="text-center mb-4">
                     <button id="btn-attack" class="btn btn-danger" onclick="simulateAttack()" disabled>Simulovat √∫tok</button>
                </div>

                <!-- V√Ωstupn√≠ oblast -->
                <div id="output-area" class="bg-gray-800 p-4 rounded-lg border border-gray-700 min-h-[100px]">
                    <h3 class="font-semibold mb-2 text-gray-400">V√Ωstup:</h3>
                    <pre id="output-content" class="text-sm whitespace-pre-wrap"></pre>
                </div>

                <!-- Tlaƒç√≠tko pro reset -->
                <div class="text-center mt-6">
                    <button id="btn-reset" class="btn btn-secondary" onclick="resetSimulation()">Resetovat simulaci</button>
                </div>
            </div>
        </div>

        <!-- Obsah z√°lo≈æky O TPM -->
        <div id="content-about" class="tab-content">
            <h2 class="text-xl font-semibold mb-4 text-blue-400">Co je TPM (Trusted Platform Module)?</h2>
            <p class="mb-3">TPM je specializovan√Ω bezpeƒçnostn√≠ ƒçip, kter√Ω je fyzicky integrov√°n do z√°kladn√≠ desky poƒç√≠taƒçe nebo notebooku.</p>
            <p class="mb-3">Jeho hlavn√≠m √∫kolem je bezpeƒçnƒõ generovat, ukl√°dat a spravovat kryptografick√© kl√≠ƒçe. Tyto kl√≠ƒçe se pou≈æ√≠vaj√≠ pro r≈Øzn√© bezpeƒçnostn√≠ funkce:</p>
            <ul class="list-disc list-inside mb-3 space-y-1 text-gray-300">
                <li><strong>Bezpeƒçn√© ≈°ifrov√°n√≠ disku:</strong> Nap≈ô√≠klad pomoc√≠ BitLockeru ve Windows. Kl√≠ƒç k de≈°ifrov√°n√≠ disku je v√°z√°n na TPM.</li>
                <li><strong>Ovƒõ≈ôen√≠ integrity syst√©mu:</strong> TPM m≈Ø≈æe zkontrolovat, zda syst√©m nebyl p≈ôi startu pozmƒõnƒõn (nap≈ô. malwarem).</li>
                <li><strong>Bezpeƒçn√© ukl√°d√°n√≠ hesel a certifik√°t≈Ø:</strong> Chr√°n√≠ citliv√© √∫daje p≈ôed softwarov√Ωmi √∫toky.</li>
            </ul>
            <h3 class="font-semibold mb-2 text-gray-400">Proƒç je lep≈°√≠ ne≈æ jen heslo?</h3>
            <p class="mb-3">Kl√≠ƒçe ulo≈æen√© v TPM jsou v√°z√°ny na konkr√©tn√≠ hardware. Je velmi obt√≠≈æn√© (prakticky nemo≈æn√© bƒõ≈æn√Ωmi prost≈ôedky) je z ƒçipu extrahovat nebo zkop√≠rovat. I kdy≈æ √∫toƒçn√≠k z√≠sk√° fyzick√Ω p≈ô√≠stup k disku, bez spr√°vn√©ho TPM (nebo obnovovac√≠ho kl√≠ƒçe) data neroz≈°ifruje.</p>
            <p>Heslo samo o sobƒõ m≈Ø≈æe b√Ωt prolomeno (nap≈ô. h√°d√°n√≠m, slovn√≠kov√Ωm √∫tokem) nebo odposlechnuto. TPM p≈ôid√°v√° hardwarovou vrstvu zabezpeƒçen√≠, kter√° je mnohem odolnƒõj≈°√≠.</p>
        </div>

    </div>

    <!-- JavaScript pro interaktivitu -->
    <script>
        // --- Glob√°ln√≠ promƒõnn√© stavu ---
        let currentMode = null; // 'with-tpm' nebo 'without-tpm'
        let secretMessageStore = null; // Ukl√°d√° p≈Øvodn√≠ zpr√°vu
        let encryptedData = null; // Simuluje ≈°ifrovan√° data (v re≈æimu TPM je to jen placeholder)
        let tpmKey = null; // Simulovan√Ω kl√≠ƒç generovan√Ω TPM
        let tpmId = null; // Simulovan√Ω identifik√°tor TPM zobrazen√Ω u≈æivateli
        let isLocked = false; // Sleduje, zda je trezor zamƒçen√Ω/data zabezpeƒçen√°

        // --- Odkazy na DOM prvky ---
        const modeSelectionDiv = document.getElementById('mode-selection');
        const simulationAreaDiv = document.getElementById('simulation-area');
        const modeTitle = document.getElementById('mode-title');
        const secretMessageInput = document.getElementById('secret-message');
        const outputContent = document.getElementById('output-content');
        const btnSecure = document.getElementById('btn-secure');
        const btnUnlock = document.getElementById('btn-unlock');
        const btnAttack = document.getElementById('btn-attack');
        const btnReset = document.getElementById('btn-reset');
        const unlockSection = document.getElementById('unlock-section');
        const tpmIdInput = document.getElementById('tpm-id-input');
        const vaultElement = document.getElementById('vault');
        const vaultIcon = document.getElementById('vault-icon');
        const statusText = document.getElementById('status-text');
        const statusLed = document.getElementById('status-led');
        const tabSim = document.getElementById('tab-sim');
        const tabAbout = document.getElementById('tab-about');
        const contentSim = document.getElementById('content-sim');
        const contentAbout = document.getElementById('content-about');

        // --- Funkce pro aktualizaci UI ---
        function updateStatus(text, ledColor = 'off') {
            statusText.textContent = text;
            statusLed.className = `led led-${ledColor}`; // Dynamick√© nastaven√≠ t≈ô√≠dy LED
        }

        function updateVault(state) { // 'initial', 'locked', 'unlocked', 'broken'
            // Reset t≈ô√≠d
            vaultElement.classList.remove('vault-locked', 'vault-unlocked', 'vault-broken', 'neon-blue', 'neon-green', 'neon-red');
            switch (state) {
                case 'locked':
                    vaultElement.classList.add('vault-locked', 'neon-blue');
                    vaultIcon.textContent = 'üîí';
                    updateStatus('Zabezpeƒçeno', 'blue');
                    break;
                case 'unlocked':
                    vaultElement.classList.add('vault-unlocked', 'neon-green');
                    vaultIcon.textContent = 'üîì';
                     updateStatus('Odemƒçeno', 'green');
                    break;
                case 'broken':
                     vaultElement.classList.add('vault-broken', 'neon-red');
                    vaultIcon.textContent = 'üí•';
                    updateStatus('Chyba/Naru≈°eno', 'red');
                    break;
                case 'initial':
                default:
                     vaultIcon.textContent = '‚ùî'; // V√Ωchoz√≠ ikona
                     updateStatus('P≈ôipraven', 'off');
                     // M≈Ø≈æeme zde p≈ôidat i v√Ωchoz√≠ t≈ô√≠du, pokud je pot≈ôeba, nap≈ô. neutr√°ln√≠ ≈°edou
                     vaultElement.classList.add('border-gray-400'); // Zajist√≠, ≈æe m√° v≈ædy nƒõjak√Ω border
                    break;
            }
        }

        function displayOutput(message, type = 'info') { // 'info', 'success', 'error', 'key'
            let colorClass = 'text-gray-300'; // V√Ωchoz√≠ barva
            if (type === 'success') colorClass = 'text-green-400 neon-green';
            if (type === 'error') colorClass = 'text-red-400 neon-red';
            if (type === 'key') colorClass = 'text-blue-400'; // Pro kl√≠ƒçe/ID

            // Sanitizace pro zobrazen√≠ HTML tag≈Ø jako textu, pokud by byly ve zpr√°vƒõ
            const sanitizedMessage = message.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            // Pou≈æit√≠ innerHTML pro aplikaci t≈ô√≠d barev
            outputContent.innerHTML = `<span class="${colorClass}">${sanitizedMessage}</span>`;
        }

        // --- Logika simulace ---

        function selectMode(mode) {
            currentMode = mode;
            modeSelectionDiv.classList.add('hidden'); // Skr√Ωt v√Ωbƒõr re≈æimu
            simulationAreaDiv.classList.remove('hidden'); // Zobrazit oblast simulace
            resetSimulationState(); // Resetovat stav pro nov√Ω bƒõh

            if (mode === 'with-tpm') {
                modeTitle.textContent = 'Re≈æim: S TPM ‚úÖ';
                modeTitle.className = 'text-xl font-semibold mb-4 text-center text-green-400'; // Zelen√Ω nadpis
                 displayOutput('TPM je aktivn√≠. P≈ôipraven k zabezpeƒçen√≠ zpr√°vy.');
            } else {
                modeTitle.textContent = 'Re≈æim: Bez TPM ‚ùå';
                modeTitle.className = 'text-xl font-semibold mb-4 text-center text-red-400'; // ƒåerven√Ω nadpis
                displayOutput('TPM nen√≠ k dispozici. Data nebudou hardwarovƒõ chr√°nƒõna.');
            }
        }

        // Pomocn√° funkce pro generov√°n√≠ pseudo-n√°hodn√©ho hex ≈ôetƒõzce
        function generatePseudoHex(length) {
            let result = '';
            const characters = 'ABCDEF0123456789';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function secureMessage() {
            const message = secretMessageInput.value.trim();
            if (!message) {
                displayOutput('Chyba: Zadejte pros√≠m tajnou zpr√°vu.', 'error');
                return;
            }

            secretMessageStore = message;
            isLocked = true;
            btnSecure.disabled = true;      // Zamknout tlaƒç√≠tko Zabezpeƒçit
            btnUnlock.disabled = false;     // Odemknout tlaƒç√≠tko Odemknout
            btnAttack.disabled = false;     // Povolit tlaƒç√≠tko √ötok
            secretMessageInput.disabled = true; // Zamknout vstupn√≠ pole
            unlockSection.classList.add('hidden'); // Skr√Ωt sekci pro odemƒçen√≠
            tpmIdInput.value = '';          // Vyƒçistit pole pro TPM ID pro jistotu

            if (currentMode === 'with-tpm') {
                // Simulace TPM: Generov√°n√≠ kl√≠ƒçe a ID
                tpmKey = `KEY-${generatePseudoHex(16)}`; // Vygenerovat del≈°√≠ "kl√≠ƒç"
                tpmId = `TPM-${generatePseudoHex(4)}`;   // Vygenerovat krat≈°√≠ "ID"
                encryptedData = `[Za≈°ifrov√°no pomoc√≠ ${tpmKey}]`; // Jen symbolick√° reprezentace

                updateVault('locked');
                displayOutput(`Zpr√°va zabezpeƒçena pomoc√≠ TPM.\nTPM vygeneroval kl√≠ƒç: (skryt√Ω)\nTPM Identifik√°tor: ${tpmId}\n\nPro odemƒçen√≠ zadejte spr√°vn√Ω TPM Identifik√°tor.`, 'key');

            } else { // Bez TPM
                // Bez TPM data nejsou skuteƒçnƒõ chr√°nƒõna
                encryptedData = `(Pseudo-≈°ifrov√°no/Nezabezpeƒçeno): ${message}`;
                tpmKey = null;
                tpmId = null;

                updateVault('broken'); // Indikuje nezabezpeƒçen√Ω/snadno naru≈°iteln√Ω stav
                displayOutput('Varov√°n√≠: Bez TPM nelze data bezpeƒçnƒõ za≈°ifrovat.\nData jsou ulo≈æena nezabezpeƒçenƒõ nebo jen slabƒõ chr√°nƒõna.', 'error');
            }
        }

        function prepareUnlock() {
            if (!isLocked) {
                 displayOutput('Nen√≠ co odemykat. Nejprve zabezpeƒçte zpr√°vu.', 'error');
                return;
            }

            if (currentMode === 'with-tpm') {
                // V re≈æimu s TPM zobrazit pole pro zad√°n√≠ ID
                unlockSection.classList.remove('hidden');
                displayOutput(`P≈ôipraven k odemƒçen√≠. Zadejte TPM Identifik√°tor (nap≈ô. ${tpmId}) pro ovƒõ≈ôen√≠.`, 'info');
                 tpmIdInput.focus(); // Automaticky zamƒõ≈ôit kurzor na vstupn√≠ pole
            } else {
                // V re≈æimu bez TPM rovnou "odemknout" (proto≈æe nen√≠ co ovƒõ≈ôovat)
                unlockMessage();
            }
        }

        function unlockMessage() {
            if (!isLocked) return; // Pojistka

            if (currentMode === 'with-tpm') {
                const enteredId = tpmIdInput.value.trim();
                if (enteredId.toUpperCase() === tpmId.toUpperCase()) { // Porovn√°n√≠ bez ohledu na velikost p√≠smen
                    // Spr√°vn√© ID
                    updateVault('unlocked');
                    displayOutput(`P≈ô√≠stup povolen! TPM kl√≠ƒç ovƒõ≈ôen.\nP≈Øvodn√≠ zpr√°va:\n${secretMessageStore}`, 'success');
                    isLocked = false;
                    btnUnlock.disabled = true; // Zamknout Odemknout
                    btnAttack.disabled = true; // Zamknout √ötok
                    unlockSection.classList.add('hidden'); // Skr√Ωt sekci odemƒçen√≠
                    btnSecure.disabled = false; // Povolit Zabezpeƒçit
                    secretMessageInput.disabled = false; // Povolit vstup
                } else {
                    // Nespr√°vn√© ID
                     updateVault('locked'); // Z≈Øst√°v√° zamƒçeno
                    displayOutput('Chyba: Zadan√Ω TPM Identifik√°tor neodpov√≠d√°. P≈ô√≠stup zam√≠tnut.', 'error');
                    tpmIdInput.focus(); // Udr≈æet focus na poli pro opravu
                    tpmIdInput.select(); // Oznaƒçit text pro snadn√© p≈ôeps√°n√≠
                }
            } else { // Bez TPM
                // Nen√≠ co ovƒõ≈ôovat, rovnou zobrazit zpr√°vu (s varov√°n√≠m)
                updateVault('unlocked'); // I kdy≈æ je to "rozbit√Ω" z√°mek
                displayOutput(`Data "odemƒçena" (nebyla ≈ô√°dnƒõ zabezpeƒçena).\nP≈Øvodn√≠ zpr√°va (potenci√°lnƒõ kompromitovan√°):\n${secretMessageStore}`, 'error'); // Zobrazit jako chybu/varov√°n√≠
                isLocked = false;
                btnUnlock.disabled = true;
                btnAttack.disabled = true;
                btnSecure.disabled = false;
                secretMessageInput.disabled = false;
            }
        }

        function simulateAttack() {
             if (!isLocked) {
                 displayOutput('Nelze √∫toƒçit na nezabezpeƒçen√Ω/odemƒçen√Ω trezor.', 'info');
                 return;
             }

            if (currentMode === 'with-tpm') {
                 updateVault('locked'); // Z≈Øst√°v√° zamƒçeno
                displayOutput('Pokus o √∫tok detekov√°n!\nTPM chr√°n√≠ kl√≠ƒç. P≈ô√≠stup k dat≈Øm bez spr√°vn√©ho TPM ID selhal.', 'error');
                // TPM by mohl implementovat i proti-√∫tokov√© mechanismy (nap≈ô. zamƒçen√≠ na ƒças), ale to zde nesimulujeme.
            } else { // Bez TPM
                updateVault('broken'); // Z√°mek je rozbit√Ω/nefunkƒçn√≠
                displayOutput(`Pokus o √∫tok detekov√°n!\nBez ochrany TPM byla data snadno p≈ô√≠stupn√°.\nKompromitovan√° zpr√°va: ${secretMessageStore}`, 'error');
                // V tomto p≈ô√≠padƒõ √∫toƒçn√≠k z√≠skal data.
            }
        }


        function resetSimulationState() {
            // Resetovat promƒõnn√©
            secretMessageStore = null;
            encryptedData = null;
            tpmKey = null;
            tpmId = null;
            isLocked = false;

            // Resetovat UI prvky
            secretMessageInput.value = '';
            secretMessageInput.disabled = false;
            tpmIdInput.value = '';
            outputContent.innerHTML = ''; // Vyƒçistit v√Ωstup
            unlockSection.classList.add('hidden'); // Skr√Ωt sekci odemƒçen√≠
            btnSecure.disabled = false;     // Povolit Zabezpeƒçit
            btnUnlock.disabled = true;      // Zamknout Odemknout
            btnAttack.disabled = true;      // Zamknout √ötok

            updateVault('initial'); // Resetovat vizu√°l trezoru

            // Nastavit v√Ωchoz√≠ zpr√°vu ve v√Ωstupu podle aktu√°ln√≠ho re≈æimu (pokud je zvolen)
             if (currentMode === 'with-tpm') {
                 displayOutput('TPM je aktivn√≠. P≈ôipraven k zabezpeƒçen√≠ zpr√°vy.');
             } else if (currentMode === 'without-tpm') {
                 displayOutput('TPM nen√≠ k dispozici. Data nebudou hardwarovƒõ chr√°nƒõna.');
             } else {
                 // Pokud je≈°tƒõ nen√≠ zvolen re≈æim (nap≈ô. po √∫pln√©m resetu)
                 displayOutput('Vyberte re≈æim pro spu≈°tƒõn√≠ simulace.');
             }
        }

        // Funkce pro √∫pln√Ω reset simulace (n√°vrat k v√Ωbƒõru re≈æimu)
        function resetSimulation() {
            currentMode = null; // Zru≈°it v√Ωbƒõr re≈æimu
            simulationAreaDiv.classList.add('hidden'); // Skr√Ωt oblast simulace
            modeSelectionDiv.classList.remove('hidden'); // Zobrazit v√Ωbƒõr re≈æimu
            resetSimulationState(); // Resetovat stav simulace
            updateStatus('P≈ôipraven', 'off'); // Resetovat glob√°ln√≠ stav na LEDce
            showTab('sim'); // Ujistit se, ≈æe je vidƒõt z√°lo≈æka simulace
        }

        // --- P≈ôep√≠n√°n√≠ z√°lo≈æek ---
        function showTab(tabId) {
            // Skr√Ωt ve≈°ker√Ω obsah
            contentSim.classList.remove('active');
            contentAbout.classList.remove('active');
            // Deaktivovat v≈°echna tlaƒç√≠tka z√°lo≈æek (styl)
            tabSim.classList.remove('active', 'bg-gray-700', 'text-white');
            tabSim.classList.add('bg-gray-800', 'text-gray-400', 'hover:bg-gray-700');
            tabAbout.classList.remove('active', 'bg-gray-700', 'text-white');
            tabAbout.classList.add('bg-gray-800', 'text-gray-400', 'hover:bg-gray-700');

            // Zobrazit vybran√Ω obsah a aktivovat tlaƒç√≠tko
            if (tabId === 'sim') {
                contentSim.classList.add('active');
                tabSim.classList.add('active', 'bg-gray-700', 'text-white');
                tabSim.classList.remove('bg-gray-800', 'text-gray-400', 'hover:bg-gray-700');
            } else { // 'about'
                contentAbout.classList.add('active');
                tabAbout.classList.add('active', 'bg-gray-700', 'text-white');
                 tabAbout.classList.remove('bg-gray-800', 'text-gray-400', 'hover:bg-gray-700');
            }
        }

        // --- Poƒç√°teƒçn√≠ nastaven√≠ p≈ôi naƒçten√≠ str√°nky ---
        simulationAreaDiv.classList.add('hidden'); // Skr√Ωt simulaci, dokud nen√≠ vybr√°n re≈æim
        updateVault('initial'); // Nastavit v√Ωchoz√≠ stav trezoru

    </script>

</body>
</html>
